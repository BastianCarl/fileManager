@rootURL = http://localhost:8080
@userName = sambata
@password = sambata
@boundary = WebAppBoundary
@file = steam.jpg
###
# @name login
POST {{rootURL}}/login
Content-Type: application/json
Accept: application/json

{
  "userName": "{{userName}}",
  "password": "{{password}}"
}

> {%
    try {
        const ct = response.headers["content-type"] || "";
        let token = null;
        if (ct.includes("application/json")) {
            const j = JSON.parse(response.body);
            token = j.token || j.accessToken || (j.data && j.data.token);
        } else {
            token = (response.body || "").trim();
        }
        if (!token) {
            client.log("Login response body: " + response.body);
            throw new Error("Token not found in login response.");
        }
        client.global.set("token", token);
    } catch (e) {
        client.log("Failed to parse login response: " + e.message);
        throw e;
    }
%}

###
GET {{rootURL}}/files/search/{{file}}
Authentication: Bearer {{token}}